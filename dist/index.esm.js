function _forEach(t,e){return Array.prototype.forEach.call(t,function(t,n){e(t,n)})}function isCanvasSupported(){let t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}function _startHandler(t){t.preventDefault(),this.moveEventHandler=_moveHandler.bind(this),this.canvas.addEventListener(this.events[1],this.moveEventHandler,!1),this.endEventHandler=_endHandler.bind(this),document.addEventListener(this.events[2],this.endEventHandler,!1)}function _moveHandler(t){t.preventDefault();var e=this.supportTouch?t.touches[0]:t,n=this.canvas.getBoundingClientRect(),s=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft,a=e.pageX-n.left-i,h=e.pageY-n.top-s;this.ctx.beginPath(),this.ctx.fillStyle="#FFFFFF",this.ctx.globalCompositeOperation="destination-out",this.ctx.arc(a,h,2*this.defaultOptions.radius,0,2*Math.PI),this.ctx.fill()}function _endHandler(t){t.preventDefault(),this.defaultOptions.callback&&"function"==typeof this.defaultOptions.callback&&this.calcRatio(this.defaultOptions.callback),this.canvas.removeEventListener(this.events[1],this.moveEventHandler,!1),document.removeEventListener(this.events[2],this.endEventHandler,!1)}class HappyGua{constructor(t){this.canvas=null,this.ctx=null,this.wrapEle=null,this.innerEle=null,this.canvasW=0,this.canvasH=0,this.supportTouch=!1,this.events=[],this.startEventHandler=null,this.moveEventHandler=null,this.endEventHandler=null,this.defaultOptions={radius:10,coverColor:"#CCCCCC",coverText:"",coverPic:"",ratio:.8},this.init(t)}init(t){if(!isCanvasSupported())throw new Error("对不起，当前浏览器不支持Canvas，无法使用本控件！");_forEach(arguments,t=>{if("object"==typeof t)for(var e in t)"callback"===e&&"function"==typeof t[e]?this.defaultOptions.callback=t[e].bind(this):e in this.defaultOptions&&(this.defaultOptions[e]=t[e]);else"function"==typeof t&&(this.defaultOptions.callback=t.bind(this))}),this.wrapEle=document.querySelector(t.ele),this.innerEle=this.wrapEle.children[0],this.wrapEle&&this.innerEle&&(this.canvasH=this.wrapEle.clientHeight,this.canvasW=this.wrapEle.clientWidth,this.innerEle.style.opacity=0,this.createCanvas(),this.eventDetect())}createCanvas(){if(this.canvas=document.createElement("canvas"),this.canvas.id="cover",this.canvas.height=this.canvasH,this.canvas.width=this.canvasW,this.canvas.style.position="absolute",this.canvas.style.top=0,this.ctx=this.canvas.getContext("2d"),this.defaultOptions.coverPic){let t=new Image;t.src=this.defaultOptions.coverPic,t.onload=(()=>{this.ctx.drawImage(t,0,0,this.canvas.width,this.canvas.height)})}else this.ctx.strokeStyle="#888686",this.ctx.fillText("刮开此涂层",this.canvas.width/2,this.canvas.height/2),this.ctx.fillStyle=this.defaultOptions.coverColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.wrapEle.appendChild(this.canvas),this.innerEle.style.opacity=1}eventDetect(){"ontouchstart"in window&&(this.supportTouch=!0),this.events=this.supportTouch?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"],this.listenStart()}listenStart(){this.startEventHandler=_startHandler.bind(this),this.canvas.addEventListener(this.events[0],this.startEventHandler,!1)}clearAll(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.removeEventListener(this.events[0],this.startEventHandler),this.canvas.removeEventListener(this.events[1],this.moveEventHandler),this.canvas.removeEventListener(this.events[2],this.endEventHandler)}calcRatio(t){var e=this.ctx.getImageData(0,0,this.canvasW,this.canvasH),n=[];_forEach(e.data,function(t,s){var i=e.data[s+3];0===i&&n.push(i)}),n.length/e.data.length>this.defaultOptions.ratio&&t&&"function"==typeof t&&t()}}export default HappyGua;
